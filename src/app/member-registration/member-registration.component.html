<div class="member-registration">
  <h2>Member Registration</h2>
  <form (ngSubmit)="openConfirmationPopup()">
    <div *ngFor="let field of sortedFields">
      <label *ngIf="field.show">
        {{ field.label }} <span *ngIf="field.required" style="color: red">*</span>

        <!-- Address Field -->
        <kendo-textarea *ngIf="field.show && field.type === 'textarea'" [(ngModel)]="formData[field.name]"
          [name]="field.name" [rows]="3" [cols]="40">
        </kendo-textarea>


        <!-- Name Field -->
        <input *ngIf="field.show && field.name === 'name'" type="text" [(ngModel)]="formData[field.name]"
          [name]="field.name" (input)="validateName()" />

        <!-- Error Message (Name) -->
        <div *ngIf="nameError && field.name === 'name'" class="error-message">
          Name can only contain letters (A-Z, a-z)
        </div>

        <!-- Email Field with Suggestions -->
        <div *ngIf="field.show && field.type === 'email'">
          <input type="email" [(ngModel)]="formData[field.name]" [name]="field.name" (input)="validateEmail()" />

          <!-- Email Suggestions Dropdown -->
          <ul *ngIf="showSuggestions && emailSuggestions.length > 0" class="email-suggestions">
            <li *ngFor="let suggestion of emailSuggestions" (click)="selectEmailSuggestion(suggestion)">
              {{ suggestion }}
            </li>
          </ul>
        </div>
        <!-- Error Message (Email) -->
        <div *ngIf="emailError && field.name === 'email'" class="error-message">
          Please enter a valid email address (e.g., exampledomain.com)
        </div>

        <!-- Mobile Number Field -->
        <div *ngIf="field.show && field.type === 'tel'">
          <select (change)="onCountryChange($event)">
            <option *ngFor="let country of countries" [value]="country.code">
              {{ country.name }} ({{ country.code }})
            </option>
          </select>
          <input *ngIf="field.show && field.type === 'tel'" type="tel" [(ngModel)]="formData[field.name]"
            [name]="field.name" pattern="[0-9+()-\s]*" inputmode="tel" (input)="validateMobile()" />
        </div>

        <!-- Error Message (Mobile) -->
        <div *ngIf="mobileError && field.name === 'mobile'" class="error-message">
          Please enter a valid mobile number.
        </div>

      </label>
    </div>

    <button kendoButton type="submit">Submit</button>
  </form>
</div>

<!--  Custom Confirmation Popup -->
<div class="custom-dialog" *ngIf="showPopup">
  <div class="custom-dialog-content">
    <span class="close-btn" (click)="closePopup()">&times;</span>
    <h2>Confirm Submission</h2>

    <div class="form-summary">
      <div *ngFor="let field of sortedFields" class="summary-row">
        <strong>{{ field.label }}:</strong> {{ formData[field.name] || 'N/A' }}
      </div>
    </div>

    <div class="dialog-actions">
      <button (click)="editForm()">Edit</button>
      <button (click)="submitForm()">Submit</button>
    </div>
  </div>
</div>